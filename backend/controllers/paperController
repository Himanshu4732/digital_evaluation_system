const paperModel = require("../models/paperModel");
const { validationResult } = require("express-validator");
const studentModel = require("../models/studentModel");

exports.createPaper = async (req, res) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({ errors: errors.array() });
  }

  const { subject, date_of_exam, studentEmail, total_marks, answerSheet } =
    req.body;

  try {
    const studentDetail = await studentModel.findOne({ email: studentEmail });
    console.log(studentDetail);

    if (!studentDetail) {
      return res.status(404).json({ message: "Student not found" });
    }

    const newPaper = new paperModel({
      subject,
      date_of_exam,
      student: studentDetail._id,
      total_marks,
      answerSheet,
    });

    await newPaper.save();
    studentDetail.papers.push(newPaper._id);
    await studentDetail.save();
    res
      .status(201)
      .json({ message: "Paper created successfully", paper: newPaper });
  } catch (error) {
    res.status(500).json({ message: "Server error", error: error.message });
  }
};
